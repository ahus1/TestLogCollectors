# Log Collectors

[![Build Status](https://travis-ci.org/haasted/TestLogCollectors.svg?branch=master)](https://travis-ci.org/haasted/TestLogCollectors)
[![Maven Central](https://maven-badges.herokuapp.com/maven-central/dk.bitcraft/LogCollector/badge.svg)](https://maven-badges.herokuapp.com/maven-central/dk.bitcraft/LogCollector)
[![license](https://img.shields.io/github/license/mashape/apistatus.svg)](https://github.com/haasted/TestLogCollectors/blob/master/LICENSE)
[![Javadoc](https://img.shields.io/badge/javadoc-OK-blue.svg)](https://javadoc.io/doc/dk.bitcraft/LogCollector/)

Application logging is important and occasionally important enough to make it worth creating automated tests to verify it. Enter Log Collectors, which captures log records for inspection or verification during testing. 

The framework is a [JUnit Rule](https://github.com/junit-team/junit4/wiki/Rules), which hooks into any logger it is provided, and intercepts its messages.

It is applicable in situations where you want to
 - ensure that THE warning is emitted during an error 
 - verify that the audit logs gets populated correctly

Log Collectors currently has support for the following libraries
 - [Log4j2](https://logging.apache.org/log4j/2.x/)
 - [Logback](https://logback.qos.ch/)
 - [java.util.logging](https://docs.oracle.com/javase/8/docs/technotes/guides/logging/overview.html)
 - [slf4j](https://www.slf4j.org/) (slf4j-simple, logback, log4j, java.util.logging)

The goals of the framework are
 - Only mandatory dependency is JUnit.
 - Support for the most widespread logging frameworks

Feedback is appreciated. If you find the framework useful, or have suggestions for improving it, get in touch!

# Usage

The following example shows how to include the JUnit rule in a test, provide it with the logger and inspect the log entries generated by testing a component.

```java
@Rule
public LogCollector collector = new LogCollector(LogManager.getLogger("acme.Gizmo"));

@Test
public void testGizmo() {
    Gizmo gizmo = new Gizmo();
    gizmo.run();

    List<LogEvent> rawLogs = (List<LogEvent>) collector.getRawLogs();
    assertTrue(rawLogs.stream().noneMatch(l -> l.getLevel() == Level.ERROR));
}
```

# Installation

Log Collectors is available from [Maven Central](http://search.maven.org/#search%7Cga%7C1%7Ca%3A%22LogCollector%22).

Maven installation
```xml
<dependency>
    <groupId>dk.bitcraft</groupId>
    <artifactId>LogCollector</artifactId>
    <version>0.7.0</version>
    <scope>test</scope>
</dependency>
```

Gradle installation
```
testCompile 'dk.bitcraft:LogCollector:0.7.0'
```

# Future work

  - Come up with a better name for the framework.
  - Improve Javadoc and documentation.
  - Discover the intricacies of the various logging frameworks in real-world settings and adapt to them.
  - Avoid the ugly cast in `getRawLogs`.
  - Detect SLF4j's `NOPLogger` and replace it with `SimpleLogger`
  - Any ideas? Get in touch!
